<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MindfulFeed | Settings</title>
    <link rel="stylesheet" href="settings.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>‚öôÔ∏è MindfulFeed Settings</h1>
        <p class="subtitle">Configure AI analysis and extension behavior</p>
      </header>

      <main>
        <!-- AI API Settings -->
        <section class="card">
          <h2>ü§ñ AI Analysis Settings</h2>
          <p class="description">
            Enable advanced AI analysis using OpenAI's latest models for highly accurate content categorization.
            Without an API key, the extension uses NLP heuristics (keyword matching).
          </p>

          <div class="form-group">
            <label for="apiKey">
              OpenAI API Key
              <span class="optional">(optional)</span>
            </label>
            <div class="input-with-button">
              <input
                type="password"
                id="apiKey"
                placeholder="sk-proj-..."
                class="input"
              />
              <button id="toggleApiKey" class="btn-link">Show</button>
            </div>
          </div>

          <div class="form-group">
            <label for="aiModel">
              OpenAI Model
              <span class="optional">(for AI mode)</span>
            </label>
            <select id="aiModel" class="input">
              <option value="gpt-4o">GPT-4o (Best quality, multimodal - images + text)</option>
              <option value="gpt-4o-mini" selected>GPT-4o-mini (Recommended - fast, multimodal, affordable)</option>
              <option value="gpt-4-turbo">GPT-4 Turbo (Older, multimodal)</option>
              <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Cheapest, text-only, lower quality)</option>
            </select>
            <small style="color: #666; display: block; margin-top: 5px;">
              <strong>Note:</strong> GPT-4o and GPT-4o-mini support vision (analyzing images). GPT-3.5 is text-only.
            </small>
          </div>

          <div class="info-box">
            <strong>üìù How to get an API key:</strong>
            <ol>
              <li>Visit <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com/api-keys</a></li>
              <li>Sign up or log in to your OpenAI account</li>
              <li>Click "Create new secret key"</li>
              <li>Copy and paste it above</li>
              <li><strong>Add credits:</strong> <a href="https://platform.openai.com/account/billing" target="_blank">platform.openai.com/account/billing</a> (min $5)</li>
            </ol>
            <p><strong>Analysis Approach:</strong> OpenAI uses <strong>Single-Stage Multimodal Analysis</strong> - GPT-4o analyzes images and captions together in one call for maximum accuracy and efficiency.</p>
            <p><strong>Cost:</strong> ~$0.01-0.05 per session depending on model (very affordable)</p>
            <p><strong>New users:</strong> OpenAI no longer provides free credits. You must add at least $5 to use the API.</p>
            <p><strong>Privacy:</strong> Your data is sent to OpenAI for analysis. See their <a href="https://openai.com/privacy" target="_blank">privacy policy</a>.</p>
          </div>

          <div class="form-actions">
            <button id="saveSettings" class="btn btn-primary">üíæ Save Settings</button>
            <button id="testApi" class="btn btn-secondary">üß™ Test API</button>
          </div>

          <div id="statusMessage" class="status-message hidden"></div>
        </section>

        <!-- Analysis Mode -->
        <section class="card">
          <h2>üìä Analysis Mode</h2>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="analysisMode" value="heuristic" checked />
              <div class="radio-content">
                <strong>Heuristic Analysis (Default)</strong>
                <p>Fast, offline keyword matching. Free. Good accuracy (~75%).</p>
              </div>
            </label>

            <label class="radio-option">
              <input type="radio" name="analysisMode" value="local" />
              <div class="radio-content">
                <strong>üñ•Ô∏è LM Studio (Local AI) - Recommended!</strong>
                <p><strong>100% FREE, Private, Unlimited!</strong> Run AI models on your computer. Uses <strong>Two-Stage Analysis</strong>: Vision model describes images, then text model categorizes. No API keys, no internet, no costs. Excellent accuracy (~90-95%).</p>
              </div>
            </label>

            <label class="radio-option">
              <input type="radio" name="analysisMode" value="ai" />
              <div class="radio-content">
                <strong>OpenAI Direct API</strong>
                <p>Direct OpenAI API access. Requires paid API key (~$0.01-0.03 per session). Excellent accuracy (~95%).</p>
              </div>
            </label>
          </div>

          <!-- LM Studio Settings (shown when Local mode selected) -->
          <div id="localModelSection" class="form-group hidden" style="margin-top: 20px;">
            <div class="info-box">
              <strong>üñ•Ô∏è LM Studio - FREE Local AI Models!</strong>
              <p><strong>100% FREE ‚Ä¢ 100% Private ‚Ä¢ Works Offline ‚Ä¢ Unlimited Usage</strong></p>
              <p>Run powerful AI models directly on your computer. All processing happens locally - no data leaves your machine!</p>
              <p><strong>Two-Stage Analysis Approach:</strong></p>
              <ul style="margin-top: 10px;">
                <li><strong>Stage 1 (Vision Model):</strong> Analyzes images and generates detailed descriptions</li>
                <li><strong>Stage 2 (Text Model):</strong> Categorizes posts based on descriptions + captions</li>
                <li><strong>Benefits:</strong> Lower VRAM usage, works with specialized models, more efficient for local processing</li>
              </ul>
            </div>

            <div class="form-group" style="margin-top: 15px;">
              <label for="localEndpoint">
                LM Studio API Endpoint
                <span class="optional">(default: http://localhost:1234/v1)</span>
              </label>
              <input
                type="text"
                id="localEndpoint"
                placeholder="http://localhost:1234/v1"
                class="input"
                value="http://localhost:1234/v1"
              />
            </div>

            <div class="info-box" style="margin-top: 15px;">
              <strong>üìù Quick Setup Guide (5 minutes):</strong>
              <ol>
                <li><strong>Download LM Studio:</strong> <a href="https://lmstudio.ai" target="_blank">lmstudio.ai</a> (Free for Windows/Mac/Linux)</li>
                <li><strong>Install and open</strong> LM Studio</li>
                <li><strong>Download a model:</strong> Click "Search" tab, search for <strong>"Qwen3-VL-4B"</strong> (vision model - analyzes images!) or <strong>"Phi-3 Mini"</strong> (text-only), click Download</li>
                <li><strong>Start the server:</strong> Click "Local Server" tab ‚Üí Click "Start Server"</li>
                <li><strong>Load the model:</strong> Select your downloaded model from the dropdown</li>
                <li><strong>Done!</strong> Save settings and start tracking</li>
              </ol>

              <p><strong>Recommended Models:</strong></p>
              <ul>
                <li><strong>Qwen3-VL-4B (Vision Model) ‚≠ê BEST!</strong> - Analyzes images AND text! Perfect for Instagram. Fast, accurate (~95%). 6-8GB RAM.</li>
                <li><strong>Qwen2-VL-7B (Vision Model)</strong> - Better quality vision analysis. Needs 10-12GB RAM.</li>
                <li><strong>Phi-3 Mini (3.8B)</strong> - Text-only, fast, works on most computers. Good for captions only (~90%).</li>
                <li><strong>Gemma 2 9B</strong> - Text-only, better accuracy, needs 16GB RAM.</li>
              </ul>

              <p><strong>üí° Vision Models are HIGHLY RECOMMENDED!</strong> They analyze the actual images in Instagram posts, not just captions. This gives much better results!</p>

              <p><strong>System Requirements:</strong> 8GB+ RAM recommended. GPU optional but faster.</p>
              <p><strong>Privacy:</strong> 100% private! All data stays on your computer. Nothing sent to internet.</p>
            </div>
          </div>

        </section>

        <!-- Privacy -->
        <section class="card">
          <h2>üîí Privacy</h2>
          <ul class="privacy-list">
            <li>‚úÖ All data stored locally on your device</li>
            <li>‚úÖ No cloud sync or external servers (except optional OpenAI API)</li>
            <li>‚úÖ Anonymous leaderboard IDs (no personal info)</li>
            <li>‚úÖ No tracking pixels or analytics</li>
            <li>‚ö†Ô∏è If using AI mode, captions are sent to OpenAI for analysis</li>
          </ul>
        </section>

        <!-- About -->
        <section class="card">
          <h2>‚ÑπÔ∏è About</h2>
          <p><strong>Version:</strong> 1.0.0</p>
          <p><strong>License:</strong> MIT</p>
          <p>
            <strong>GitHub:</strong>
            <a href="https://github.com/chakirLbr/MindFulFeed" target="_blank">
              github.com/chakirLbr/MindFulFeed
            </a>
          </p>
        </section>
      </main>
    </div>

    <script src="settings.js"></script>
  </body>
</html>
